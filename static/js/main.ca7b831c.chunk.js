(this["webpackJsonpmoney-book"]=this["webpackJsonpmoney-book"]||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(44),s=n.n(r),i=(n(53),n(13)),o=n(25),l=n(10),u=n.n(l),d=n(30),m=n(17),p=n(4),j=n(5),h=n(7),b=n(6),f=(n(55),n(56),"list"),O="chart",g="outcome",v=function(e){return e<10?"0"+e:e},x=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[],a=0;a<e;a++)n[a]=t+a;return n},y=function(e){var t=e?new Date(e):new Date;return{year:t.getFullYear(),month:t.getMonth()+1}},N=function(e){return e.reduce((function(e,t){return e[t.id]=t,e}),{})},C="#347eff",k="#28a745",w="#dc3545",S="#555",I="#efefef",D="#fff",M=n(0),P=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).handleClick=function(e){a.node.contains(e.target)||a.setState({isOpen:!1})},a.toggleDropdown=function(e){e.preventDefault(),a.setState({isOpen:!a.state.isOpen})},a.selectYear=function(e,t){e.preventDefault(),a.setState({selectedYear:t})},a.selectMonth=function(e,t){e.preventDefault(),a.setState({isOpen:!1}),a.props.onChange(a.state.selectedYear,t)},a.state={isOpen:!1,selectedYear:a.props.year},a}return Object(j.a)(n,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClick,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClick,!1)}},{key:"render",value:function(){var e=this,t=this.props,n=t.year,a=t.month,c=this.state.selectedYear,r=this.state.isOpen,s=x(12,1),i=x(9,-4).map((function(e){return e+n}));return Object(M.jsxs)("div",{className:"dropdown month-picker-component",ref:function(t){e.node=t},children:[Object(M.jsx)("p",{children:"\u9009\u62e9\u6708\u4efd"}),Object(M.jsx)("button",{className:"btn btn-md btn-secondary dropdown-toggle",onClick:this.toggleDropdown,children:"".concat(n,"\u5e74 ").concat(v(a),"\u6708")}),r&&Object(M.jsx)("div",{className:"dropdown-menu",style:{display:"block"},children:Object(M.jsxs)("div",{className:"row",children:[Object(M.jsx)("div",{className:"col border-right years-range",children:i.map((function(t,n){return Object(M.jsxs)("a",{role:"button",onClick:function(n){e.selectYear(n,t)},className:t===c?"dropdown-item active text-white":"dropdown-item",children:[t," \u5e74"]},n)}))}),Object(M.jsx)("div",{className:"col months-range",children:s.map((function(t,n){return Object(M.jsxs)("a",{role:"button",onClick:function(n){e.selectMonth(n,t)},className:t===a?"dropdown-item active text-white":"dropdown-item",children:[v(t)," \u6708"]},n)}))})]})})]})}}]),n}(c.a.Component),F=c.a.createContext(),T=function(e){return function(t){return Object(M.jsx)(F.Consumer,{children:function(n){var a=n.state,c=n.actions;return Object(M.jsx)(e,Object(i.a)(Object(i.a)({},t),{},{data:a,actions:c}))}})}},L=function(e){var t=e.income,n=e.outcome;return Object(M.jsxs)("div",{className:"col",children:[Object(M.jsx)("div",{className:"row mb-3",children:Object(M.jsxs)("h5",{className:"sm income",children:["\u6536\u5165\uff1a",Object(M.jsxs)("span",{children:[t,"\u5143"]})]})}),Object(M.jsx)("div",{className:"row",children:Object(M.jsxs)("h5",{className:"sm outcome",children:["\u652f\u51fa\uff1a",Object(M.jsxs)("span",{children:[n,"\u5143"]})]})})]})},z=n(9),V=n.n(z),Y=function(e){var t=e.items,n=e.onModifyItem,a=e.onDeleteItem;return Object(M.jsx)("ul",{className:" list-group list-group-flush",children:t.map((function(e){return Object(M.jsxs)("li",{className:"list-group-item d-flex \r justify-content-between align-items-center",children:[Object(M.jsx)("span",{className:" no-padding col-1",children:Object(M.jsx)(V.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:C,padding:"5px"},color:"#fff",icon:e.category.iconName})}),Object(M.jsx)("span",{className:" col-3",children:e.title}),Object(M.jsxs)("span",{className:"no-padding col-3 font-weight-bold",children:["income"===e.category.type?"+":"-",e.price,"\u5143"]}),Object(M.jsx)("span",{className:"no-padding col-3",children:e.date}),Object(M.jsx)("a",{className:"no-padding col-1",role:"button",onClick:function(t){t.preventDefault(),n(e)},children:Object(M.jsx)(V.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:k,padding:"5px"},color:"#fff",icon:"ios-create-outline"})}),Object(M.jsx)("a",{className:" col-1",role:"button",onClick:function(t){t.preventDefault(),a(e)},children:Object(M.jsx)(V.a,{className:"rounded-circle",fontSize:"30px",style:{backgroundColor:w,padding:"5px"},color:"#fff",icon:"ios-close"})})]},e.id)}))})},E=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).tabChange=function(e,t){e.preventDefault(),a.setState({activeIndex:t}),a.props.onTabChange(t)},a.state={activeIndex:e.activeIndex},a}return Object(j.a)(n,[{key:"render",value:function(){var e=this,t=this.props.children,n=this.state.activeIndex;return Object(M.jsx)("ul",{className:"nav nav-tabs nav-fill my-4 ",children:c.a.Children.map(t,(function(t,a){var c=n===a?"nav-link active":"nav-link";return Object(M.jsx)("li",{className:"nav-item",children:Object(M.jsx)("a",{onClick:function(t){e.tabChange(t,a)},className:c,role:"button",children:t})})}))})}}]),n}(c.a.Component),A=function(e){var t=e.children;return Object(M.jsx)(c.a.Fragment,{children:t})},J=function(e){var t=e.onClick;return Object(M.jsxs)("button",{className:"btn btn-primary btn-block d-flex justify-content-center align-items-center",onClick:function(e){t()},children:[Object(M.jsx)(V.a,{className:"rounded-circle",fontSize:"30px",color:"#fff",icon:"ios-add-circle"}),Object(M.jsx)("div",{className:"sm",children:"\u521b\u5efa\u4e00\u6761\u65b0\u7684\u8bb0\u8d26\u8bb0\u5f55"})]})},H=n.p+"static/media/logo.6ce24c58.svg",_=function(){return Object(M.jsxs)("div",{className:"loading-component text-center",children:[Object(M.jsx)(V.a,{icon:"ios-refresh",fontSize:"40px",color:C,rotate:!0}),Object(M.jsx)("h5",{children:"\u52a0\u8f7d\u4e2d"})]})},q=[f,O],B=T(function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).onChangeDate=function(e,t){a.props.actions.selectNewMonth(e,t)},a.modifyItem=function(e){a.props.history.push("/edit/".concat(e.id))},a.deleteItem=function(e){a.props.actions.deleteItem(e)},a.handleClick=function(){a.props.history.push("/create")},a.changeView=function(e){a.setState({tabsView:q[e]})},a.state={tabView:q[0]},a}return Object(j.a)(n,[{key:"componentDidMount",value:function(){this.props.actions.getInitalData()}},{key:"render",value:function(){var e=this.props.data,t=e.items,n=e.categories,a=e.currentDate,r=e.isLoading,s=this.state.tabView,i=Object.keys(t).map((function(e){return t[e].category=n[t[e].cid],t[e]})),o=0,l=0;return i.forEach((function(e){e.category.type===g?l+=e.price:o+=e.price})),Object(M.jsxs)(c.a.Fragment,{children:[Object(M.jsxs)("div",{className:"App-header",children:[Object(M.jsx)("div",{className:"row mb-5 justify-content-center",children:Object(M.jsx)("img",{src:H,className:"App-logo",alt:"logo"})}),Object(M.jsxs)("div",{className:"row align-items-center",children:[Object(M.jsx)("div",{className:"col",children:Object(M.jsx)(P,{year:a.year,month:a.month,onChange:this.onChangeDate})}),Object(M.jsx)("div",{className:"col ",children:Object(M.jsx)(L,{income:o,outcome:l})})]})]}),Object(M.jsxs)("div",{className:"content-area py-3 px-3",children:[r&&Object(M.jsx)(_,{}),!r&&Object(M.jsxs)(c.a.Fragment,{children:[Object(M.jsxs)(E,{activeIndex:0,onTabChange:this.changeView,children:[Object(M.jsxs)(A,{children:[Object(M.jsx)(V.a,{className:"rounded-circle mr-2",fontSize:"25px",color:C,icon:"ios-paper"}),"\u5217\u8868\u6a21\u5f0f"]}),Object(M.jsxs)(A,{children:[Object(M.jsx)(V.a,{className:"rounded-circle mr-2",fontSize:"25px",color:C,icon:"ios-pie"}),"\u56fe\u8868\u6a21\u5f0f"]})]}),Object(M.jsx)(J,{onClick:this.handleClick}),s===f&&i.length>0&&Object(M.jsx)(Y,{items:i,onModifyItem:this.modifyItem,onDeleteItem:this.deleteItem}),s===f&&0===i.length&&Object(M.jsx)("div",{className:"alert alert-light text-center no-record",children:"\u60a8\u8fd8\u6ca1\u6709\u4efb\u4f55\u8bb0\u8d26\u8bb0\u5f55"}),s===O&&Object(M.jsx)("div",{className:"h1",children:"\u8fd9\u91cc\u662f\u56fe\u8868\u533a\u57df"})]})]})]})}}]),n}(a.Component)),R=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(j.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.categories,a=t.selectedCategory,c=(t.onSelectCategory,a&&a.id);return Object(M.jsx)("div",{className:"category-select-component",children:Object(M.jsx)("div",{className:"row",children:n.map((function(t){var n=t.id===c?D:S,a=t.id===c?C:I;return Object(M.jsxs)("div",{className:"col-3",style:{textAlign:"center"},onClick:function(n){e.props.onSelectCategory(t)},children:[Object(M.jsx)(V.a,{className:"rounded-circle",fontSize:"50px",style:{backgroundColor:a,padding:"5px"},color:n,icon:t.iconName}),Object(M.jsx)("p",{children:t.name})]})}))})})}}]),n}(a.Component),U=R,W=n(2),$=n.n(W),G=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={validatePass:!0,errorMessage:""},e}return Object(j.a)(n,[{key:"sumbitForm",value:function(e){var t=this.props,n=t.item,a=t.onFormSubmit,c=!!n.id,r=1*this.priceInput.value.trim(),s=this.dateInput.value.trim(),i=this.titleInput.value.trim();r&&s&&i?r<0?this.setState({validatePass:!1,errorMessage:"\u4ef7\u683c\u6570\u5b57\u5fc5\u987b\u5927\u4e8e0"}):!function(e){if(!e.match(/^\d{4}-\d{2}-\d{2}$/))return!1;var t=new Date(e);return!Number.isNaN(t.getTime())&&t.toISOString().slice(0,10)===e}(s)?this.setState({validatePass:!1,errorMessage:"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u65e5\u671f\u683c\u5f0f"}):(this.setState({validatePass:!0,errorMessage:""}),a(c?{id:n.id,title:i,price:r,date:s}:{title:i,price:r,date:s},c)):this.setState({validatePass:!1,errorMessage:"\u8bf7\u8f93\u5165\u6240\u6709\u5fc5\u9009\u9879"}),e.preventDefault()}},{key:"render",value:function(){var e=this,t=this.props.item,n=t.title,a=t.price,r=t.date;return Object(M.jsx)(c.a.Fragment,{children:Object(M.jsxs)("form",{onSubmit:function(t){e.sumbitForm(t)},children:[Object(M.jsxs)("div",{className:"form-group",children:[Object(M.jsx)("label",{for:"title",children:"\u6807\u9898 *"}),Object(M.jsx)("input",{type:"text",id:"title",placeholder:"\u8bf7\u8f93\u5165\u91d1\u989d",defaultValue:n,className:"form-control",ref:function(t){e.titleInput=t}})]}),Object(M.jsxs)("div",{className:"form-group",children:[Object(M.jsx)("label",{for:"money",children:"\u91d1\u989d *"}),Object(M.jsx)("input",{type:"number",id:"money",placeholder:"\u8bf7\u8f93\u5165\u6807\u9898",defaultValue:a,className:"form-control",ref:function(t){e.priceInput=t}})]}),Object(M.jsxs)("div",{className:"form-group",children:[Object(M.jsx)("label",{for:"date",children:"\u65e5\u671f *"}),Object(M.jsx)("input",{type:"date",id:"date",placeholder:"\u8bf7\u8f93\u5165\u4ef7\u683c",className:"form-control",defaultValue:r,ref:function(t){e.dateInput=t}})]}),Object(M.jsx)("button",{type:"submit",className:"btn btn-primary mt-2 mr-3",children:"\u63d0\u4ea4"}),Object(M.jsx)("button",{className:"btn btn-secondary mt-2",onClick:this.props.onCancelSubmit,children:"\u53d6\u6d88"}),!this.state.validatePass&&Object(M.jsx)("div",{className:"alert alert-danger mt-5",role:"alert",children:this.state.errorMessage})]})})}}]),n}(a.Component);G.protypes={item:$.a.object,onFormSubmit:$.a.func.isRequired,onCancelSubmit:$.a.func.isRequired},G.defaultProps={item:{}};var K=G,Q=[g,"income"],X=T(function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var a;return Object(p.a)(this,n),(a=t.call(this,e)).tabChange=function(e){a.setState({selectedTab:Q[e]})},a.selectCategory=function(e){a.setState({selectedCategory:e})},a.submitForm=function(e,t){a.state.selectedCategory?(t?a.props.actions.updateItem(e,a.state.selectedCategory.id).then(a.navigateToHome):a.props.actions.createItem(e,a.state.selectedCategory.id).then(a.navigateToHome),a.props.history.push("/")):a.setState({validationPassed:!1})},a.navigateToHome=function(){a.props.history.push("/")},a.state={selectedTab:g,selectedCategory:null,validationPassed:!0},a}return Object(j.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.id;t&&this.props.actions.getEditData(t).then((function(t){var n=t.editItem,a=t.categories;e.setState({selectedTab:n?a[n.cid].type:g,selectedCategory:n?a[n.cid]:null})}))}},{key:"cancelSubmit",value:function(){this.props.history.push("/")}},{key:"render",value:function(){var e=this.state,t=e.selectedTab,n=e.selectedCategory,a=e.validationPassed,c=Q.findIndex((function(e){return e===t})),r=this.props,s=r.data,i=(r.actions,s.items),o=s.categories,l=Object.keys(o).map((function(e){return o[e]})).filter((function(e){return e.type===t})),u=this.props.match.params.id,d=u&&i[u]?i[u]:{};return Object(M.jsxs)("div",{className:"create-page py-3 px-3 rounded mt-3",style:{background:"#fff"},children:[s.isLoading&&Object(M.jsx)(_,{}),Object(M.jsxs)(E,{activeIndex:c,onTabChange:this.tabChange,children:[Object(M.jsx)(A,{children:"\u652f\u51fa"}),Object(M.jsx)(A,{children:"\u6536\u5165"})]}),Object(M.jsx)(U,{categories:l,selectedCategory:n,onSelectCategory:this.selectCategory}),Object(M.jsx)(K,{item:d,onFormSubmit:this.submitForm,onCancelSubmit:this.cancelSubmit}),!a&&Object(M.jsx)("div",{className:"alert alert-danger mt-5",role:"alert",children:"\u8bf7\u9009\u62e9\u5206\u7c7b\u4fe1\u606f"})]})}}]),n}(a.Component)),Z=n(103),ee=n(104),te=n(14),ne=n.n(te),ae=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var a;Object(p.a)(this,n),(a=t.call(this,e)).state={items:{},categories:{},isLoading:!1,currentDate:y("2021-12")};var c=function(e){return function(){return a.setState({isLoading:!0}),e.apply(void 0,arguments)}};return a.actions={getInitalData:c(Object(m.a)(u.a.mark((function e(){var t,n,c,r,s,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.currentDate,n="/items?monthCategory=".concat(t.year,"-").concat(t.month),e.next=4,Promise.all([ne.a.get("/categories"),ne.a.get(n)]);case 4:return c=e.sent,r=Object(d.a)(c,2),s=r[0],i=r[1],a.setState({items:N(i.data),categories:N(s.data),isLoading:!1}),e.abrupt("return",{items:i,categories:s});case 8:case"end":return e.stop()}}),e)})))),selectNewMonth:c(function(){var e=Object(m.a)(u.a.mark((function e(t,n){var c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c="/items?monthCategory=".concat(t,"-").concat(n,"&_sort=timestamp&_order=desc"),e.next=3,ne.a.get(c);case 3:return r=e.sent,a.setState({items:N(r.data),currentDate:{year:t,month:n},isLoading:!1}),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),deleteItem:c(function(){var e=Object(m.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete(n=JSON.parse(JSON.stringify(a.state.items)))[t.id],a.setState({items:n,isLoading:!1});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),getEditData:c(function(){var e=Object(m.a)(u.a.mark((function e(t){var n,c,r,s,i,l,m,p,j,h;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state,c=n.items,r=n.categories,s=[],c[t]?s.push(new Promise((function(e){return e(null)}))):s.push(ne.a.get("/items/".concat(t))),0===Object.keys(r).length?s.push(ne.a.get("/categories")):s.push(new Promise((function(e){return e(null)}))),e.next=6,Promise.all(s);case 6:return i=e.sent,l=Object(d.a)(i,2),m=l[0],p=l[1],j=m?m.data:c[t],h=p?N(p.data):r,a.setState({categories:h,isLoading:!1,items:Object(o.a)({},t,j)}),e.abrupt("return",{editItem:j,categories:h});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),createItem:c(function(){var e=Object(m.a)(u.a.mark((function e(t,n){var a,c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="_"+Math.random().toString(36).substr(2,9),c=y(t.date),t.monthCategory="".concat(c.year,"-").concat(c.month),t.timestamp=new Date(t.date).getTime(),e.next=6,ne.a.post("/items",Object(i.a)(Object(i.a)({},t),{},{id:a,cid:n}));case 6:return r=e.sent,e.abrupt("return",r.data);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),updateItem:c(function(){var e=Object(m.a)(u.a.mark((function e(t,n){var a,c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=y(t.date),c=Object(i.a)(Object(i.a)({},t),{},{cid:n,timestamp:new Date(t.date).getTime(),monthCategory:"".concat(a.year,"-").concat(a.month)}),console.log(c),e.next=5,ne.a.put("/items/".concat(c.id),c);case 5:return r=e.sent,e.abrupt("return",r.data);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},a}return Object(j.a)(n,[{key:"render",value:function(){return Object(M.jsx)(F.Provider,{value:{state:this.state,actions:this.actions},children:Object(M.jsx)(Z.a,{children:Object(M.jsx)("div",{className:"App sm",children:Object(M.jsxs)("div",{className:"container pb-5",children:[Object(M.jsx)(ee.a,{exact:!0,path:"/",component:B}),Object(M.jsx)(ee.a,{path:"/create",component:X}),Object(M.jsx)(ee.a,{path:"/edit/:id",component:X})]})})})})}}]),n}(c.a.Component),ce=ae,re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,105)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),r(e),s(e)}))};s.a.render(Object(M.jsx)(c.a.StrictMode,{children:Object(M.jsx)(ce,{})}),document.getElementById("root")),re()},53:function(e,t,n){},55:function(e,t,n){}},[[100,1,2]]]);
//# sourceMappingURL=main.ca7b831c.chunk.js.map